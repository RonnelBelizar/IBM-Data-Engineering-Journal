# Topic: Module 4 ‚Äî Accessing Databases Using Python

---

# üêç How to Access Databases Using Python

Python makes it fun and simple to connect, query, and analyze data from databases. It combines SQL power with Python‚Äôs flexibility and readability.

---

## üöÄ Benefits of Python for Database Programming

| Advantage           | Description                                                                 |
|---------------------|------------------------------------------------------------------------------|
| Ease of Use         | Clean syntax for mixing SQL and Python.                                      |
| Cross-Platform      | Runs on Windows, macOS, and Linux.                                           |
| Integration Power   | Connects with almost every SQL or NoSQL database.                            |
| Vast Ecosystem      | Has tons of libraries for analysis and visualization.                        |

### Python Ecosystem

| Library     | Purpose                                |
|--------------|----------------------------------------|
| NumPy        | Numerical computations                 |
| Pandas       | Data manipulation and analysis          |
| Matplotlib   | Data visualization                     |
| SciPy        | Scientific and statistical computing    |

**Example (String Form):**
"import pandas as pd"
"import numpy as np"

---

## üìì Jupyter Notebooks

Jupyter lets you mix code, results, and visualizations in one place. It‚Äôs perfect for testing queries and exploring data.

| Benefit        | Description                                      |
|----------------|--------------------------------------------------|
| Interactive     | Run code and see results instantly              |
| Visual          | Display tables and charts together              |
| Ideal for testing | Great for exploring queries and datasets       |

**Example (String Form):**
"import pandas as pd"
"import sqlite3"
"conn = sqlite3.connect('hospital.db')"
"df = pd.read_sql('SELECT * FROM patients;', conn)"
"df.head()"

---

## üß© SQL API

Python follows a standard called DB-API for interacting with databases.

| Method         | Description                              |
|----------------|------------------------------------------|
| connect()      | Opens connection to database             |
| cursor()       | Creates a cursor object for SQL queries  |
| execute()      | Executes SQL statements                  |
| fetchone()/fetchall() | Retrieves query results           |
| commit()       | Saves changes                            |
| close()        | Closes the connection                    |

**Example (String Form):**
"import mysql.connector"
"conn = mysql.connector.connect(host='localhost', user='root', password='1234', database='company')"
"cursor = conn.cursor()"
"cursor.execute('SELECT * FROM employees;')"
"result = cursor.fetchall()"
"for row in result: print(row)"
"conn.close()"

---

## üß± APIs Used by Popular SQL-Based DBMS Systems

| Database System | API / Library         | Description                              |
|-----------------|-----------------------|------------------------------------------|
| MySQL           | mysql.connector / MySQL C API | For MySQL connectivity              |
| PostgreSQL      | psycopg2              | For PostgreSQL databases                 |
| IBM Db2         | ibm_db                | For IBM Db2 connectivity                 |
| Sybase / MSSQL  | dblib API             | For Sybase and old SQL Server versions   |
| Generic (ODBC)  | pyodbc                | Universal connection through ODBC        |
| Oracle          | cx_Oracle / oci       | For Oracle databases                     |
| Java Databases  | jdbc                  | For Java-based connectivity              |

**Example (String Form):**
"import mysql.connector"
"import psycopg2"
"import ibm_db"
"import pyodbc"
"import cx_Oracle"

---

## ‚ö° Quick Recap

| Concept          | Example (String Form)                              | Purpose                             |
|------------------|----------------------------------------------------|-------------------------------------|
| Connect to DB    | "conn = mysql.connector.connect(...)"              | Establish database connection       |
| Execute SQL      | "cursor.execute('SELECT * FROM employees;')"       | Run SQL queries                     |
| Use Pandas       | "pd.read_sql('SELECT * FROM patients;', conn)"     | Load results into DataFrame         |
| Common APIs      | "mysql.connector", "psycopg2", "ibm_db", "pyodbc"  | Interface with databases            |

---

üí¨ In short: Python + SQL = Data Magic!  
You can fetch, analyze, and visualize data effortlessly, making Python a go-to language for data engineers and analysts.

---

# üêç Writing Code Using DB-API

Python‚Äôs **DB-API (Database Application Programming Interface)** provides a standard way to connect and work with databases.  
It‚Äôs consistent across MySQL, PostgreSQL, SQLite, and many more ‚Äî making life easier for developers! ‚ö°

---

## üí° What is DB-API?

The DB-API is a **standard interface** that defines how Python applications communicate with relational databases.  
It ensures code looks the same no matter which database you use.

---

## üöÄ Benefits of DB-API

| Benefit             | Description                                                      |
|----------------------|------------------------------------------------------------------|
| Consistency          | Same functions for all supported databases.                      |
| Simplicity           | Easy to learn and apply.                                         |
| Portability          | Code works on different databases with minimal changes.          |
| Flexibility          | Supports simple queries and complex stored procedures.           |

---

## üß† Concepts of the Python DB-API

| Concept              | Description                                                                 |
|-----------------------|------------------------------------------------------------------------------|
| Connection Objects    | Represent a link to the database, used to create cursors and manage actions. |
| Cursor Objects        | Act as a pointer to execute SQL queries and fetch results.                   |

---

## üîó Common Connection Methods

| Method           | Description                                                               |
|------------------|---------------------------------------------------------------------------|
| .cursor()        | Creates a cursor object to execute SQL queries.                            |
| .commit()        | Saves any changes made to the database.                                   |
| .rollback()      | Reverses uncommitted changes.                                             |
| .close()         | Closes the connection to release resources.                               |
| .callproc()      | Executes a stored procedure.                                              |
| .execute()       | Runs a single SQL command.                                                |
| .executemany()   | Executes a SQL command multiple times with different parameters.          |
| .fetchone()      | Retrieves the next single row from a query result.                        |
| .fetchmany()     | Retrieves a specified number of rows from a query result.                 |
| .fetchall()      | Retrieves all remaining rows from a query result.                         |
| .nextset()       | Moves to the next result set if available.                                |
| .arraysize       | Sets how many rows `.fetchmany()` will return by default.                 |
| .close()         | Closes the cursor to free resources.                                      |

---

## üéØ What is a Database Cursor?

A **cursor** is like a pointer to your query results.  
It allows you to **execute statements**, **fetch data**, and **iterate** through results.

**Example (String Form):**  
"cursor = conn.cursor()"  
"cursor.execute('SELECT * FROM employees;')"  
"rows = cursor.fetchall()"  
"for row in rows: print(row)"

---

## ‚úçÔ∏è Writing Database Code Using DB-API

| Step | Action                 | Example (String Form)                           |
|------|------------------------|-------------------------------------------------|
| 1    | Import database module | "from dbmodule import connect"                  |
| 2    | Create connection      | "conn = connect('database_name')"               |
| 3    | Create cursor object   | "cursor = conn.cursor()"                        |
| 4    | Run SQL queries        | "cursor.execute('SELECT * FROM table;')"        |
| 5    | Commit changes         | "conn.commit()"                                 |
| 6    | Close resources        | "cursor.close()" and "conn.close()"             |

---

## ‚ö° Example (String Form)

"from dbmodule import connect"  
"conn = connect('company_db')"  
"cursor = conn.cursor()"  
"cursor.execute('SELECT name, salary FROM employees WHERE salary > 50000;')"  
"results = cursor.fetchall()"  
"for row in results: print(row)"  
"conn.close()"

---

üí¨ **In summary:**  
Python‚Äôs DB-API is your bridge between SQL and Python ‚Äî simple, standardized, and powerful for handling all kinds of database operations. üß†üíæ

---

# üêç Accessing Databases With SQL Magic

SQL Magic lets you run SQL queries directly in **Jupyter Notebooks** using **magic commands**.  
It‚Äôs interactive and great for exploring databases without leaving Python. ‚ú®

---

## ‚ö° Types of Cell Magics

### Line Magics

Line magics start with `%` and apply to **one line of code only**.

| Line Magic             | Description                                                                 |
|------------------------|-----------------------------------------------------------------------------|
| %pwd                    | Shows the current working directory                                         |
| %ls                     | Lists files in the current directory                                        |
| %history                | Shows command history                                                       |
| %reset                  | Clears all variables from memory                                           |
| %who                    | Lists variables in memory                                                  |
| %whos                   | Lists detailed info of variables                                           |
| %matplotlib inline      | Displays matplotlib plots inline                                           |
| %timeit                  | Measures execution time of a single line                                    |
| %lsmagic                | Lists all available magics                                                 |

**Example (String Form):**  
"%pwd"  
"%ls"  
"%history"

**Using Line Magic Statements:**  
You can run system commands or manage the notebook environment quickly using these `%` commands.

---

### Cell Magics

Cell magics start with `%%` and apply to **the entire cell**.  
They are useful for running multi-line code blocks in a special context.

**Example (String Form):**  
"%%timeit"  
"for i in range(1000):"  
"    x = i*2"

---

## üß© Using SQL Magic

SQL Magic allows running SQL queries **inside Jupyter Notebook**.

### Step 1: Install ipython-sql
**Example (String Form):**  
"!pip install ipython-sql"  

### Step 2: Enable SQL Magic
**Example (String Form):**  
"%load_ext sql"

### Step 3: Connect to SQLite Database
**Example (String Form):**  
"%sql sqlite:///my_database.db"

### Step 4: Run SQL Queries
**Example (String Form):**  
"%sql SELECT * FROM employees;"  
"%sql SELECT AVG(salary) FROM employees;"

---

üí¨ **In short:**  
SQL Magic combines Python and SQL in **one interactive notebook**.  
- `%` commands handle **environment and system tasks**  
- `%%` commands handle **multi-line or special cell tasks**  
- `%sql` lets you **query databases directly**, making data exploration seamless! üöÄ

---

