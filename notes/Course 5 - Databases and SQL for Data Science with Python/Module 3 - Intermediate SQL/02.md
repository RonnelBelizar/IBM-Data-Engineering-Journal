# Topic: Module 3 â€” Intermediate SQL

---

# ğŸ§  Built-in Database Functions â€” Your SQL Superpowers!

SQL isnâ€™t just about retrieving data â€” it can also **calculate**, **summarize**, and **transform** data right inside your queries!  
These built-in functions make your life *way* easier. ğŸª„

---

## ğŸ“Š Aggregate (or Column) Functions

Aggregate functions operate on **groups of rows** and return **a single value** â€” perfect for summarizing data.  
Theyâ€™re often used with `GROUP BY`.

### Common Aggregate Functions

| Function  | Description                      | Example (String Form)                              |
|------------|----------------------------------|----------------------------------------------------|
| `SUM()`    | Adds up values in a column       | `"SELECT SUM(salary) FROM employees;"`             |
| `AVG()`    | Returns the average value        | `"SELECT AVG(salary) FROM employees;"`             |
| `MIN()`    | Returns the smallest value       | `"SELECT MIN(age) FROM patients;"`                 |
| `MAX()`    | Returns the largest value        | `"SELECT MAX(age) FROM patients;"`                 |
| `COUNT()`  | Counts the number of rows        | `"SELECT COUNT(*) FROM employees;"`                |

### Example Table

| employee_id | name        | salary |
|--------------|-------------|--------|
| 1            | John Doe    | 50000  |
| 2            | Jane Smith  | 55000  |
| 3            | Alex Cruz   | 48000  |

âœ… **Example Query (String Form):**  
`"SELECT AVG(salary), MAX(salary), MIN(salary) FROM employees;"`

âœ… **Result:**

| avg(salary) | max(salary) | min(salary) |
|--------------|--------------|--------------|
| 51000        | 55000        | 48000        |

---

## ğŸ§® Scalar and String Functions

Scalar functions work on **individual values** (one row at a time) and return a single transformed value.  
Think of them as little editors for your data!

---

### ğŸ”¢ Numeric (Scalar) Functions

| Function  | Description                            | Example (String Form)               |
|------------|----------------------------------------|------------------------------------|
| `ROUND()`  | Rounds a number to decimal places      | `"SELECT ROUND(price, 2) FROM products;"` |
| `ABS()`    | Returns the absolute (positive) value  | `"SELECT ABS(-50);"`               |
| `POWER()`  | Raises a number to a power             | `"SELECT POWER(2, 3);"`            |

---

### ğŸ”¤ String Functions

| Function    | Description                          | Example (String Form)                                          |
|--------------|--------------------------------------|----------------------------------------------------------------|
| `LENGTH()`   | Returns number of characters          | `"SELECT LENGTH('Database');"`                                 |
| `UCASE()` / `UPPER()` | Converts text to uppercase   | `"SELECT UPPER('sql rocks');"`                                 |
| `LCASE()` / `LOWER()` | Converts text to lowercase   | `"SELECT LOWER('HELLO');"`                                     |
| `CONCAT()`   | Combines two or more strings          | `"SELECT CONCAT(first_name, ' ', last_name) FROM employees;"`  |
| `SUBSTRING()`| Extracts part of a string             | `"SELECT SUBSTRING(name, 1, 3) FROM employees;"`               |

---

### Example Table

| name        | department |
|--------------|-------------|
| John Doe     | HR          |
| Jane Smith   | IT          |

âœ… **Example Queries (String Form):**  
`"SELECT UPPER(name) FROM employees;"`  
â†’ Converts all names to uppercase.  

`"SELECT CONCAT(name, ' works in ', department) FROM employees;"`  
â†’ Combines name and department into a readable message.  

âœ… **Result:**

| message                   |
|----------------------------|
| John Doe works in HR       |
| Jane Smith works in IT     |

---

## âš¡ Quick Recap

| Category  | Function Type | Example (String Form)                                 | Description                |
|------------|----------------|------------------------------------------------------|----------------------------|
| Aggregate  | `SUM()`        | `"SELECT SUM(salary) FROM employees;"`               | Adds up all salaries       |
| Aggregate  | `AVG()`        | `"SELECT AVG(age) FROM patients;"`                   | Finds the average age      |
| Scalar     | `ROUND()`      | `"SELECT ROUND(price, 2) FROM products;"`            | Rounds decimal values      |
| String     | `UCASE()`      | `"SELECT UPPER(name) FROM employees;"`               | Converts to uppercase      |
| String     | `LENGTH()`     | `"SELECT LENGTH(name) FROM employees;"`              | Counts characters          |

---

ğŸ’¬ **In short:**  
Aggregate functions summarize data ğŸ“Š.  
Scalar and string functions fine-tune data ğŸ¨.  
Together, they make your SQL queries *smarter and cleaner*! ğŸš€

---

# â° Date and Time Built-in Functions â€” Working with Time Like a Pro!

SQL doesnâ€™t just store text and numbers â€” it can handle **dates**, **times**, and **timestamps** too!  
These functions help you extract, format, and calculate with time-based data.  
Letâ€™s explore how to *master time* in SQL. ğŸ•’âœ¨

---

## ğŸ“… Date, Time, and Timestamp Data Types

| Data Type   | Description                                | Example Value         |
|--------------|---------------------------------------------|------------------------|
| `DATE`       | Stores only the date (year, month, day)     | `2025-11-02`          |
| `TIME`       | Stores only the time (hour, minute, second) | `14:35:00`            |
| `TIMESTAMP`  | Stores both date and time                   | `2025-11-02 14:35:00` |

âœ… **Example (String Form):**  
`"SELECT CURRENT_DATE, CURRENT_TIME, CURRENT_TIMESTAMP;"`  
â†’ Returns the systemâ€™s current date and time.

âœ… **Result:**

| current_date | current_time | current_timestamp      |
|---------------|---------------|------------------------|
| 2025-11-02    | 14:35:00      | 2025-11-02 14:35:00    |

---

## ğŸ§© Date and Time Functions

You can extract specific parts of a date or time using these built-in functions.  
Theyâ€™re super useful for reporting, filtering, or grouping by date components.

| Function      | Description                              | Example (String Form)                                  | Example Result |
|----------------|------------------------------------------|--------------------------------------------------------|----------------|
| `YEAR()`       | Returns the year                         | `"SELECT YEAR('2025-11-02');"`                         | 2025           |
| `MONTH()`      | Returns the month (1â€“12)                 | `"SELECT MONTH('2025-11-02');"`                        | 11             |
| `DAY()`        | Returns the day of the month (1â€“31)      | `"SELECT DAY('2025-11-02');"`                          | 2              |
| `DAYOFMONTH()` | Same as `DAY()`                          | `"SELECT DAYOFMONTH('2025-11-02');"`                   | 2              |
| `DAYOFWEEK()`  | Returns the weekday (1=Sunday, 7=Saturday)| `"SELECT DAYOFWEEK('2025-11-02');"`                   | 1              |
| `DAYOFYEAR()`  | Returns the day number of the year        | `"SELECT DAYOFYEAR('2025-11-02');"`                    | 306            |
| `WEEK()`       | Returns the week number (1â€“52)            | `"SELECT WEEK('2025-11-02');"`                         | 44             |
| `HOUR()`       | Extracts the hour                         | `"SELECT HOUR('14:35:00');"`                           | 14             |
| `MINUTE()`     | Extracts the minute                       | `"SELECT MINUTE('14:35:00');"`                         | 35             |
| `SECOND()`     | Extracts the second                       | `"SELECT SECOND('14:35:00');"`                         | 0              |

---

## â±ï¸ Date and Time Arithmetic

You can perform **math** on dates and times â€” adding or subtracting days, months, or even seconds!  
This is especially useful for schedules, logs, or expiration tracking.

### âœ… Adding or Subtracting Days

| Operation  | Example (String Form)                                      | Result        |
|-------------|------------------------------------------------------------|---------------|
| Add days    | `"SELECT DATE_ADD('2025-11-02', INTERVAL 5 DAY);"`         | 2025-11-07    |
| Subtract days | `"SELECT DATE_SUB('2025-11-02', INTERVAL 10 DAY);"`      | 2025-10-23    |

---

### âœ… Difference Between Dates

| Function        | Example (String Form)                                      | Result |
|------------------|------------------------------------------------------------|---------|
| `DATEDIFF()`     | `"SELECT DATEDIFF('2025-11-10', '2025-11-02');"`          | 8       |

---

### âœ… Extracting Date Parts from Current Timestamp

| Function | Example (String Form)                            | Example Result |
|-----------|--------------------------------------------------|----------------|
| `YEAR()`  | `"SELECT YEAR(CURRENT_DATE);"`                   | 2025           |
| `MONTH()` | `"SELECT MONTH(CURRENT_TIMESTAMP);"`             | 11             |
| `DAY()`   | `"SELECT DAY(CURRENT_TIMESTAMP);"`               | 2              |
| `HOUR()`  | `"SELECT HOUR(CURRENT_TIME);"`                   | 14             |

---

## âš¡ Quick Recap

| Category          | Function/Example (String Form)                                | Description                     |
|--------------------|--------------------------------------------------------------|----------------------------------|
| Date Retrieval     | `"SELECT CURRENT_DATE;"`                                     | Gets todayâ€™s date               |
| Time Retrieval     | `"SELECT CURRENT_TIME;"`                                     | Gets current time               |
| Full Timestamp     | `"SELECT CURRENT_TIMESTAMP;"`                                | Gets full date and time         |
| Extract Components | `"SELECT YEAR(CURRENT_DATE);"`                               | Gets the current year           |
| Add/Subtract Time  | `"SELECT DATE_ADD('2025-11-02', INTERVAL 5 DAY);"`           | Adds 5 days                     |
| Date Difference    | `"SELECT DATEDIFF('2025-11-10', '2025-11-02');"`             | Calculates date difference      |

---

ğŸ’¬ **In short:**  
SQL lets you do way more than store dates â€” you can **extract**, **compare**, and **calculate** with them!  
Perfect for handling logs, reports, and anything time-sensitive. â³ğŸš€

---

# ğŸŒ€ Subqueries and Nested SELECTs â€” Queries Inside Queries!

Ever wished you could use the result of one query *inside another*?  
Thatâ€™s exactly what **subqueries** (also called **nested SELECTs**) do! ğŸ§©  
They let SQL answer *complex* questions by stacking queries together like layers of a cake ğŸ‚.

---

## ğŸ” What Is a Subquery?

A **subquery** is a **SELECT statement inside another query**.  
Itâ€™s used to:
- Filter data based on another query  
- Compare aggregated results  
- Perform calculations or lookups dynamically  

You can use a subquery in:
- `WHERE`
- `FROM`
- `SELECT`

âœ… **Basic Syntax (String Form):**  
`"SELECT column_name FROM table_name WHERE column_name = (SELECT column_name FROM another_table WHERE condition);"`

---

## ğŸ¯ Example 1: Subquery in WHERE

Find employees who earn more than the **average salary**.

| employee_id | name        | salary |
|--------------|-------------|--------|
| 1            | John Doe    | 50000  |
| 2            | Jane Smith  | 55000  |
| 3            | Alex Cruz   | 48000  |

âœ… **Query (String Form):**  
`"SELECT name, salary FROM employees WHERE salary > (SELECT AVG(salary) FROM employees);"`

âœ… **Step-by-step:**
1. Inner query â†’ calculates the average salary.  
2. Outer query â†’ returns employees earning above that average.

âœ… **Result:**

| name        | salary |
|--------------|--------|
| Jane Smith   | 55000  |

---

## ğŸ“¦ Example 2: Subquery in FROM (Derived Table)

You can use a subquery as a **temporary table** to simplify complex data.  
This is also called an **inline view**.

âœ… **Query (String Form):**  
`"SELECT dept, avg_salary FROM (SELECT department AS dept, AVG(salary) AS avg_salary FROM employees GROUP BY department) AS dept_avg WHERE avg_salary > 50000;"`

âœ… **Explanation:**
- Inner query groups salaries by department.
- Outer query filters departments with average salaries above 50,000.

---

## ğŸ§  Example 3: Subquery in SELECT (Scalar Subquery)

A **scalar subquery** returns a *single value* â€” perfect for displaying extra info.

âœ… **Query (String Form):**  
`"SELECT name, salary, (SELECT AVG(salary) FROM employees) AS company_avg FROM employees;"`

âœ… **Result:**

| name        | salary | company_avg |
|--------------|--------|--------------|
| John Doe     | 50000  | 51000        |
| Jane Smith   | 55000  | 51000        |
| Alex Cruz    | 48000  | 51000        |

---

## ğŸ§© Nested Subqueries (Multi-level)

Yes, you can go even deeper â€” a subquery inside another subquery!  
But beware ğŸ˜… â€” too many levels can get confusing.

âœ… **Example (String Form):**  
`"SELECT name FROM employees WHERE salary > (SELECT AVG(salary) FROM employees WHERE department_id = (SELECT department_id FROM departments WHERE name = 'IT'));"`

âœ… **What It Does:**
1. Inner-most subquery â†’ gets `department_id` for IT.  
2. Middle subquery â†’ calculates average salary for that department.  
3. Outer query â†’ returns employees earning above that IT average.

---

## âš¡ Quick Recap

| Subquery Type | Used In      | Returns              | Example (String Form) |
|----------------|---------------|----------------------|------------------------|
| **WHERE**      | `WHERE` clause | Single value or list | `"SELECT * FROM employees WHERE salary > (SELECT AVG(salary) FROM employees);"` |
| **FROM**       | `FROM` clause  | Virtual table        | `"SELECT * FROM (SELECT ... ) AS temp;"` |
| **SELECT**     | `SELECT` list  | Single (scalar) value| `"SELECT name, (SELECT COUNT(*) FROM employees) AS total FROM employees;"` |

---

ğŸ’¬ **In short:**  
Subqueries let SQL think in *layers*.  
They make it possible to answer advanced questions like:  
> â€œWho earns above average?â€  
> â€œWhich department performs the best?â€  

Itâ€™s SQL inception â€” **a query within a query!** ğŸŒ€ğŸ’¡

---

# ğŸ—ï¸ Working with Multiple Tables â€” Joining Forces in SQL

Real-world data is rarely in a single table.  
You often need to **combine information from multiple tables** to get meaningful insights.  
SQL lets you do this using **subqueries** and **joins** (implicit or explicit).  
Letâ€™s break it down! ğŸ”—

---

## ğŸ” Subqueries with Multiple Tables

You can use subqueries to **filter or calculate values from another table** while querying your main table.

### Example:

Tables:

**employees**

| employee_id | name        | department_id |
|-------------|-------------|---------------|
| 1           | John Doe    | 101           |
| 2           | Jane Smith  | 102           |
| 3           | Alex Cruz   | 101           |

**departments**

| department_id | department_name |
|---------------|----------------|
| 101           | HR             |
| 102           | IT             |

**Query (String Form):**  
`"SELECT name FROM employees WHERE department_id = (SELECT department_id FROM departments WHERE department_name = 'HR');"`

âœ… **Result:**

| name       |
|------------|
| John Doe   |
| Alex Cruz  |

**Explanation:**  
- Inner query finds the `department_id` for 'HR'.  
- Outer query returns employees in that department.

---

## ğŸ”— Implicit Join (Old-school JOIN)

Before the modern `JOIN` syntax, SQL used **implicit joins** in the `WHERE` clause.  
This combines tables based on a **common column**.

**Syntax:**  
`"SELECT columns FROM table1, table2 WHERE table1.column = table2.column;"`

### Example:

**Query (String Form):**  
`"SELECT e.name, d.department_name FROM employees e, departments d WHERE e.department_id = d.department_id;"`

âœ… **Result:**

| name       | department_name |
|------------|----------------|
| John Doe   | HR             |
| Alex Cruz  | HR             |
| Jane Smith | IT             |

**Explanation:**  
- `employees` and `departments` are listed in `FROM`.  
- `WHERE` matches `department_id` from both tables.  
- Result shows employee names with their department names.

---

## âš¡ Key Points

| Concept          | Description                                                                 | Example (String Form) |
|------------------|-----------------------------------------------------------------------------|----------------------|
| Subquery          | Query inside a query, can fetch related info from another table             | `"SELECT name FROM employees WHERE department_id = (SELECT department_id FROM departments WHERE department_name = 'HR');"` |
| Implicit Join     | Combine tables using `WHERE table1.column = table2.column`                  | `"SELECT e.name, d.department_name FROM employees e, departments d WHERE e.department_id = d.department_id;"` |

---

ğŸ’¬ **In short:**  
- **Subqueries** are great for filtering or calculating using another table.  
- **Implicit joins** combine tables by matching columns in `WHERE`.  

Together, they let you **work with multiple tables** without losing your mind! ğŸ§ âœ¨
 
